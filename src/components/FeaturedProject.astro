---
// src/components/FeaturedProject.astro
// Versión: 2.3 | CORRECCIÓN: Lógica de Slug (safeSlug)
import type { CollectionEntry } from 'astro:content';
import { getEntry } from 'astro:content';
import { mdToHtml } from '~/utils/markdown';

export interface Props {
  project: CollectionEntry<'proyectos'>;
}

const { project } = Astro.props;
const ajustes = await getEntry("ajustes", "home");
const ctaTextos = ajustes?.data.cta_textos ?? {};
const ctaText = ctaTextos.leer_mas ?? "Leer Caso Completo";

// MODIFICADO: Extraer slug de project.data
const { client_name, titulo, summary, image, slug } = project.data; 
const safeImage = image ?? '/assets/uploads/placeholder.jpeg';
const summaryHtml = summary ? mdToHtml(summary) : null;
// AÑADIDO: Usar data.slug, con fallback al slug del archivo
const safeSlug = slug ?? project.slug; 
---
<article class="
  relative w-full rounded-xl overflow-hidden 
  bg-secondary
  border border-gray-200
  grid grid-cols-1 lg:grid-cols-2 gap-0
  shadow-xl
">
  <div class="relative min-h-[300px] lg:min-h-[450px] overflow-hidden group">
    <img 
      src={safeImage} 
      alt={`Proyecto ${titulo}`} 
      class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" 
    />
    <div class="absolute inset-0 bg-gradient-to-t from-gray-900/50 to-transparent lg:bg-gradient-to-r lg:from-transparent lg:to-gray-900/50"></div>
  </div>
  <div class="flex flex-col justify-center p-8 md:p-12 lg:p-16 relative z-10">
   <div class="mb-4">
      <span class="inline-block py-1 px-3 rounded bg-accent-secondary/10 border border-accent-secondary/20 text-accent-secondary font-sans text-xs font-bold uppercase tracking-widest">
        {client_name}
      </span>
    </div>
    <h2 class="font-serif text-3xl md:text-4xl lg:text-5xl font-bold text-text-base mb-6 leading-tight">
      {titulo}
    </h2>
    {summaryHtml && (
      <div class="prose prose-lg max-w-none text-text-base/80 mb-8 prose-strong:text-accent">
        <span set:html={summaryHtml} />
      </div>
    )}
    <div>
      <a 
        href={`/proyectos/${safeSlug}`} 
        class="
          inline-flex items-center justify-center
          bg-accent-secondary text-text-inverted font-bold 
          py-3 px-8 text-base rounded-sm
          transition-all duration-300 
          hover:bg-accent 
          hover:text-text-inverted
          shadow-lg hover:shadow-xl
          no-underline hover:no-underline
        "
      >
        {ctaText}
      </a>
    </div>
  </div>
</article>